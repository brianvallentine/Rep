{"Code": "EXEC SQL SELECT T1.NUM_APOLICE, T1.COD_SUBGRUPO, T1.RAMO_COBERTURA, CASE WHEN (T1.COD_COBERTURA = 22 AND T1.DATA_INIVIGENCIA >= T6.DATA_QUITACAO) THEN 01 ELSE T1.COD_COBERTURA END, T1.DATA_INIVIGENCIA FROM seguros.VG_COBERTURAS_SUBG T1 LEFT JOIN SEGUROS.PROPOSTAS_VA T6 ON T6.NUM_CERTIFICADO = :V0PROPOSTAVA.NRCERTIF LEFT JOIN SEGUROS.VG_COBER_SUBG_HIST T2 ON (T2.NUM_APOLICE = T1.NUM_APOLICE AND T2.COD_SUBGRUPO = T1.COD_SUBGRUPO AND T2.COD_COBERTURA = T1.COD_COBERTURA) WHERE T1.NUM_APOLICE = :NUM_APOLICE AND T1.COD_SUBGRUPO = :COD_SUBGRUPO AND ((T1.SIT_COBERTURA = '0') OR (T1.SIT_COBERTURA = '1' AND T1.NUM_APOLICE = T2.NUM_APOLICE AND T1.COD_SUBGRUPO = T2.COD_SUBGRUPO AND T1.COD_COBERTURA = T2.COD_COBERTURA AND T2.DATA_TERVIGENCIA > T6.DATA_QUITACAO AND T2.DATA_TERVIGENCIA = (SELECT MAX(T3.DATA_TERVIGENCIA) FROM SEGUROS.VG_COBER_SUBG_HIST T3 WHERE T3.NUM_APOLICE = T1.NUM_APOLICE AND T3.COD_COBERTURA = T1.COD_COBERTURA AND T3.COD_SUBGRUPO = T1.COD_SUBGRUPO AND T3.DATA_TERVIGENCIA <> '9999-12-31') AND NOT EXISTS (SELECT T4.COD_COBERTURA FROM SEGUROS.VG_COBER_SUBG_HIST T4 WHERE T4.NUM_APOLICE = T1.NUM_APOLICE AND T4.COD_SUBGRUPO = T1.COD_SUBGRUPO AND T4.COD_COBERTURA = 22 AND T1.COD_COBERTURA = 01 AND ((T4.DATA_TERVIGENCIA = '9999-12-31') OR (T4.DATA_TERVIGENCIA >= T2.DATA_TERVIGENCIA))) ORDER BY 1, 2, 3 END SQL", "Inputs": [{"Field": ":NUM_APOLICE", "Type": "string"}, {"Field": ":COD_SUBGRUPO", "Type": "string"}], "Outputs": [{"Field": "NUM_APOLICE", "Type": "string"}, {"Field": "COD_SUBGRUPO", "Type": "string"}, {"Field": "RAMO_COBERTURA", "Type": "string"}, {"Field": "COD_COBERTURA", "Type": "string"}, {"Field": "DATA_INIVIGENCIA", "Type": "string"}], "Endpoint": "vgmpa/vgmpp036"}